# Especificação da API - Monex\n\nEste documento descreve os endpoints da API RESTful do Monex, definindo os contratos de comunicação entre o frontend e o backend, e entre o backend e serviços externos. Utiliza-se um formato similar ao OpenAPI/Swagger para clareza.\n\n## 1. Autenticação e Usuários\n\n### 1.1. Cadastro de Usuário\n*   **Endpoint:** `/api/v1/auth/register`\n*   **Método:** `POST`\n*   **Descrição:** Registra um novo usuário com e-mail e senha.\n*   **Requisição:**\n    ```json\n    {\n        "email": "user@example.com",\n        "password": "senhaSegura123",\n        "name": "Nome do Usuário"\n    }\n    ```\n*   **Resposta (Sucesso - 201 Created):**\n    ```json\n    {\n        "message": "Usuário registrado com sucesso!",\n        "userId": "uuid-do-usuario"\n    }\n    ```\n*   **Resposta (Erro - 400 Bad Request):**\n    ```json\n    {\n        "error": "E-mail já cadastrado"\n    }\n    ```\n\n### 1.2. Login de Usuário\n*   **Endpoint:** `/api/v1/auth/login`\n*   **Método:** `POST`\n*   **Descrição:** Autentica um usuário e retorna um token de acesso (JWT).\n*   **Requisição:**\n    ```json\n    {\n        "email": "user@example.com",\n        "password": "senhaSegura123"\n    }\n    ```\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "accessToken": "eyJhbGciOiJIUzI1Ni...",\n        "tokenType": "Bearer",\n        "expiresIn": 3600\n    }\n    ```\n*   **Resposta (Erro - 401 Unauthorized):**\n    ```json\n    {\n        "error": "Credenciais inválidas"\n    }\n    ```\n\n### 1.3. Login com Rede Social\n*   **Endpoint:** `/api/v1/auth/social/:provider` (ex: `/api/v1/auth/social/google`)\n*   **Método:** `GET`\n*   **Descrição:** Inicia o fluxo OAuth para login via rede social. O backend redirecionará para o provedor e, após autenticação, redirecionará de volta para o frontend com o token.\n*   **Parâmetros de Path:**\n    *   `provider`: `string` (e.g., `google`, `facebook`)\n*   **Resposta:** Redirecionamento e, posteriormente, um token de acesso no frontend.\n\n### 1.4. Obter Perfil do Usuário\n*   **Endpoint:** `/api/v1/users/me`\n*   **Método:** `GET`\n*   **Descrição:** Retorna os dados do perfil do usuário autenticado.\n*   **Autenticação:** Token JWT no cabeçalho `Authorization: Bearer <token>`\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "userId": "uuid-do-usuario",\n        "name": "Nome do Usuário",\n        "email": "user@example.com",\n        "subscriptionStatus": "active",\n        "plan": "premium"\n    }\n    ```\n\n## 2. Assinatura e Pagamento\n\n### 2.1. Obter Planos de Assinatura\n*   **Endpoint:** `/api/v1/subscriptions/plans`\n*   **Método:** `GET`\n*   **Descrição:** Lista os planos de assinatura disponíveis.\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    [\n        {\n            "id": "plan-basic",\n            "name": "Plano Básico",\n            "price": 19.90,\n            "currency": "BRL",\n            "features": ["Contas ilimitadas", "Categorização automática"]\n        }\n    ]\n    ```\n\n### 2.2. Iniciar Assinatura / Processar Pagamento\n*   **Endpoint:** `/api/v1/subscriptions/checkout`\n*   **Método:** `POST`\n*   **Descrição:** Inicia o processo de checkout para uma nova assinatura ou renovação. Integração com provedor de pagamento (ex: Stripe, PagSeguro).\n*   **Requisição:**\n    ```json\n    {\n        "planId": "plan-premium",\n        "paymentMethodToken": "tok_visa" // Token gerado pelo frontend via SDK do provedor de pagamento\n    }\n    ```\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "message": "Assinatura iniciada com sucesso!",\n        "subscriptionId": "sub_abc123"\n    }\n    ```\n\n## 3. Integração Open Banking\n\n### 3.1. Conectar Nova Conta Bancária\n*   **Endpoint:** `/api/v1/openbanking/connect`\n*   **Método:** `POST`\n*   **Descrição:** Inicia o fluxo de conexão com uma instituição financeira via Open Banking. Retorna uma URL para redirecionamento do usuário.\n*   **Autenticação:** Token JWT\n*   **Requisição:**\n    ```json\n    {\n        "bankId": "id-do-banco-selecionado",\n        "redirectUrl": "https://monex.com/openbanking/callback"\n    }\n    ```\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "authorizationUrl": "https://bank.com/auth?client_id=...&redirect_uri=..."\n    }\n    ```\n\n### 3.2. Callback de Autenticação Open Banking\n*   **Endpoint:** `/api/v1/openbanking/callback`\n*   **Método:** `GET` (ou `POST`, dependendo da especificação Open Banking)\n*   **Descrição:** Endpoint que o provedor Open Banking chama de volta após a autenticação do usuário. O backend processa o código de autorização e obtém o token de acesso aos dados bancários.\n*   **Parâmetros de Query:** (ex: `code`, `state` - definidos pela especificação Open Banking)\n*   **Resposta:** Redirecionamento para o dashboard do Monex com status da conexão.\n\n### 3.3. Sincronizar Dados Bancários\n*   **Endpoint:** `/api/v1/openbanking/sync/:accountId`\n*   **Método:** `POST`\n*   **Descrição:** Força uma sincronização de dados para uma conta bancária específica.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Path:**\n    *   `accountId`: `string` (ID da conta bancária conectada)\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "message": "Sincronização iniciada com sucesso!"\n    }\n    ```\n\n## 4. Lançamentos Financeiros (Transações)\n\n### 4.1. Criar Lançamento\n*   **Endpoint:** `/api/v1/transactions`\n*   **Método:** `POST`\n*   **Descrição:** Adiciona uma nova despesa ou receita (única ou recorrente).\n*   **Autenticação:** Token JWT\n*   **Requisição:**\n    ```json\n    {\n        "type": "expense", // "expense" ou "revenue"\n        "amount": 150.75,\n        "description": "Almoço com cliente",\n        "date": "2024-07-20",\n        "categoryId": "uuid-da-categoria",\n        "isRecurring": false,\n        "frequency": "monthly", // Opcional, se isRecurring for true (daily, weekly, monthly, yearly)\n        "recurrenceEndDate": "2025-07-20" // Opcional, se isRecurring for true\n    }\n    ```\n*   **Resposta (Sucesso - 201 Created):**\n    ```json\n    {\n        "transactionId": "uuid-da-transacao",\n        "message": "Lançamento criado com sucesso!"\n    }\n    ```\n\n### 4.2. Listar Lançamentos\n*   **Endpoint:** `/api/v1/transactions`\n*   **Método:** `GET`\n*   **Descrição:** Retorna uma lista de lançamentos financeiros do usuário.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Query (Opcionais):**\n    *   `type`: `string` (e.g., `expense`, `revenue`)\n    *   `startDate`: `string` (formato YYYY-MM-DD)\n    *   `endDate`: `string` (formato YYYY-MM-DD)\n    *   `categoryId`: `string` (ID da categoria)\n    *   `isRecurring`: `boolean`\n    *   `page`: `number`\n    *   `limit`: `number`\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "total": 100,\n        "page": 1,\n        "limit": 10,\n        "data": [\n            {\n                "id": "uuid-da-transacao-1",\n                "type": "expense",\n                "amount": 35.00,\n                "description": "Assinatura Adobe CC",\n                "date": "2024-07-15",\n                "category": {\n                    "id": "uuid-cat-1",\n                    "name": "Software"\n                },\n                "isRecurring": true\n            }\n            // ... mais transações\n        ]\n    }\n    ```\n\n### 4.3. Obter Detalhes do Lançamento\n*   **Endpoint:** `/api/v1/transactions/:id`\n*   **Método:** `GET`\n*   **Descrição:** Retorna os detalhes de um lançamento específico.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Path:**\n    *   `id`: `string` (ID do lançamento)\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "id": "uuid-da-transacao-1",\n        "type": "expense",\n        "amount": 35.00,\n        "description": "Assinatura Adobe CC",\n        "date": "2024-07-15",\n        "categoryId": "uuid-cat-1",\n        "isRecurring": true,\n        "frequency": "monthly",\n        "recurrenceEndDate": "2025-07-15",\n        "createdAt": "2024-07-10T10:00:00Z",\n        "updatedAt": "2024-07-10T10:00:00Z"\n    }\n    ```\n\n### 4.4. Atualizar Lançamento\n*   **Endpoint:** `/api/v1/transactions/:id`\n*   **Método:** `PUT`\n*   **Descrição:** Atualiza os dados de um lançamento existente.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Path:**\n    *   `id`: `string` (ID do lançamento)\n*   **Requisição:** (Campos opcionais, apenas os que serão atualizados)\n    ```json\n    {\n        "description": "Almoço de negócios",\n        "amount": 160.00,\n        "categoryId": "uuid-nova-categoria"\n    }\n    ```\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "message": "Lançamento atualizado com sucesso!"\n    }\n    ```\n\n### 4.5. Excluir Lançamento\n*   **Endpoint:** `/api/v1/transactions/:id`\n*   **Método:** `DELETE`\n*   **Descrição:** Exclui um lançamento específico.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Path:**\n    *   `id`: `string` (ID do lançamento)\n*   **Resposta (Sucesso - 204 No Content):** (Resposta vazia)\n\n## 5. Categorias\n\n### 5.1. Listar Categorias\n*   **Endpoint:** `/api/v1/categories`\n*   **Método:** `GET`\n*   **Descrição:** Retorna uma lista de categorias de despesas/receitas.\n*   **Autenticação:** Token JWT\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    [\n        {\n            "id": "uuid-cat-1",\n            "name": "Alimentação",\n            "type": "expense"\n        },\n        {\n            "id": "uuid-cat-2",\n            "name": "Salário",\n            "type": "revenue"\n        }\n    ]\n    ```\n\n### 5.2. Criar Categoria\n*   **Endpoint:** `/api/v1/categories`\n*   **Método:** `POST`\n*   **Descrição:** Cria uma nova categoria.\n*   **Autenticação:** Token JWT\n*   **Requisição:**\n    ```json\n    {\n        "name": "Transporte Público",\n        "type": "expense" // "expense" ou "revenue"\n    }\n    ```\n*   **Resposta (Sucesso - 201 Created):**\n    ```json\n    {\n        "categoryId": "uuid-da-nova-categoria",\n        "message": "Categoria criada com sucesso!"\n    }\n    ```\n\n### 5.3. Atualizar Categoria\n*   **Endpoint:** `/api/v1/categories/:id`\n*   **Método:** `PUT`\n*   **Descrição:** Atualiza o nome ou tipo de uma categoria.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Path:**\n    *   `id`: `string` (ID da categoria)\n*   **Requisição:**\n    ```json\n    {\n        "name": "Transporte Urbano"\n    }\n    ```\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "message": "Categoria atualizada com sucesso!"\n    }\n    ```\n\n### 5.4. Excluir Categoria\n*   **Endpoint:** `/api/v1/categories/:id`\n*   **Método:** `DELETE`\n*   **Descrição:** Exclui uma categoria. (Pode exigir validação para categorias em uso).\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Path:**\n    *   `id`: `string` (ID da categoria)\n*   **Resposta (Sucesso - 204 No Content):** (Resposta vazia)\n\n## 6. Dashboard e Relatórios\n\n### 6.1. Obter Resumo do Dashboard\n*   **Endpoint:** `/api/v1/dashboard/summary`\n*   **Método:** `GET`\n*   **Descrição:** Retorna os dados resumidos para o dashboard (total de receitas, despesas, saldo).\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Query (Opcionais):**\n    *   `startDate`: `string` (formato YYYY-MM-DD)\n    *   `endDate`: `string` (formato YYYY-MM-DD)\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    {\n        "totalRevenue": 5000.00,\n        "totalExpense": 2500.00,\n        "balance": 2500.00,\n        "currency": "BRL"\n    }\n    ```\n\n### 6.2. Obter Estatísticas por Categoria\n*   **Endpoint:** `/api/v1/dashboard/category-stats`\n*   **Método:** `GET`\n*   **Descrição:** Retorna estatísticas de despesas/receitas por categoria para um período.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Query (Opcionais):**\n    *   `startDate`: `string`\n    *   `endDate`: `string`\n    *   `type`: `string` (e.g., `expense`, `revenue`)\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    [\n        {\n            "categoryName": "Alimentação",\n            "categoryId": "uuid-cat-1",\n            "amount": 800.00,\n            "percentage": 32.0\n        },\n        {\n            "categoryName": "Transporte",\n            "categoryId": "uuid-cat-3",\n            "amount": 400.00,\n            "percentage": 16.0\n        }\n    ]\n    ```\n\n### 6.3. Obter Histórico de Saldo (para Gráficos)\n*   **Endpoint:** `/api/v1/dashboard/balance-history`\n*   **Método:** `GET`\n*   **Descrição:** Retorna dados históricos de saldo para plotagem de gráficos.\n*   **Autenticação:** Token JWT\n*   **Parâmetros de Query (Opcionais):**\n    *   `period`: `string` (e.g., `last-month`, `last-year`, `custom`)\n    *   `startDate`: `string` (obrigatório se `period` for `custom`)\n    *   `endDate`: `string` (obrigatório se `period` for `custom`)\n*   **Resposta (Sucesso - 200 OK):**\n    ```json\n    [\n        {\n            "date": "2024-01-31",\n            "balance": 1000.00\n        },\n        {\n            "date": "2024-02-29",\n            "balance": 1200.50\n        }\n    ]\n    ``` 